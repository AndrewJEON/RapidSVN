AC_INIT(src/rapidsvn_app.cpp)
AM_INIT_AUTOMAKE(rapidsvn, 0.1)

AC_PROG_CXX
AC_PROG_INSTALL
AC_LIBTOOL_DLOPEN
AC_PROG_LIBTOOL

dnl
dnl APR
dnl

APRCONFIG=apr-config
AC_ARG_WITH(apr-config,
[[  --with-apr-config=FILE    Use the given path to apr-config when determining
                            APR configuration; defaults to "apr-config"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        APRCONFIG=$withval
    fi
])
AC_MSG_CHECKING([for APR])
if $APRCONFIG --cflags > /dev/null; then
    AC_MSG_RESULT([found])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([APR is required. Try --with-apr-config.])
fi
CPPFLAGS="$CPPFLAGS  `$APRCONFIG --cppflags` `$APRCONFIG --includes`"
CXXFLAGS="$CXXFLAGS `$APRCONFIG --cflags`"
APR_LIBS="`$APRCONFIG --link-ld --libs`"

dnl
dnl Subversion
dnl

SVNCONFIG=svn-config
AC_ARG_WITH(svn-config,
[[  --with-svn-config=FILE    Use the given path to svn-config when determining
                            Subversion configuration; defaults to "svn-config"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        SVNCONFIG=$withval
    fi
])
AC_MSG_CHECKING([for Subversion])
if $SVNCONFIG --cflags > /dev/null; then
    AC_MSG_RESULT([found])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([Subversion is required. Try --with-svn-config.])
fi
CPPFLAGS="$CPPFLAGS `$SVNCONFIG --cppflags` `$SVNCONFIG --includes`"
CXXFLAGS="$CXXFLAGS `$SVNCONFIG --cflags`"
SVN_LIBS="`$SVNCONFIG --libs`"

dnl
dnl wxWindows
dnl

WXCONFIG=wx-config
AC_ARG_WITH(wx-config,
[[  --with-wx-config=FILE     Use the given path to wx-config when determining
                            wxWindows configuration; defaults to "wx-config"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        WXCONFIG=$withval
    fi
])
AC_MSG_CHECKING([wxWindows version])
if wxversion=`$WXCONFIG --version`; then
    AC_MSG_RESULT([$wxversion])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([wxWindows is required. Try --with-wx-config.])
fi
case $wxversion in
    [2.3.3])
        ;;
    [2.4.0])
        ;;
    *)
        AC_MSG_ERROR([wxWindows 2.3.3 or 2.4.0 required])
	AC_MSG_ERROR([Try --with-wx-config.])
        ;;
esac
CPPFLAGS="$CPPFLAGS `$WXCONFIG --cppflags`"
CXXFLAGS="$CXXFLAGS `$WXCONFIG --cxxflags | sed -e 's/-fno-exceptions//'`"
WX_LIBS="`$WXCONFIG --libs`"

dnl
dnl CppUnit
dnl 

CPPUNITCONFIG=
AC_ARG_WITH(cppunit-config,
[[  --with-cppunit-config=FILE     Use the given path to cppunit-config
                            when determining the cpp Unit configuration; 
                            defaults to ""]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        CPPUNITCONFIG=$withval
    fi
])

AC_SUBST(APR_LIBS)
AC_SUBST(WX_LIBS)

AC_OUTPUT(Makefile src/Makefile src/svncpp/Makefile src/res/Makefile)

if test "$CPPUNITCONFIG" ; then
    CPPUNIT_CXXFLAGS="`$CPPUNITCONFIG --cflags`"
    CPPUNIT_LIBS="`$CPPUNITCONFIG --libs`"
    AC_SUBST(CPPUNIT_LIBS)
    AC_SUBST(CPPUNIT_CXXFLAGS)
    AC_OUTPUT(src/tests/svncpp/Makefile)
fi
