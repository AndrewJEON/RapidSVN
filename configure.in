AC_INIT(src/rapidsvn_app.cpp)
AM_INIT_AUTOMAKE(rapidsvn, 0.1)

AC_PROG_CXX
AC_PROG_INSTALL
AC_LIBTOOL_DLOPEN
AC_PROG_LIBTOOL

CPPFLAGS="$CPPFLAGS -Wall -g -fexceptions"
CXXFLAGS="$CXXFLAGS -Wall -g -fexceptions"

dnl
dnl APR
dnl

APRCONFIG=apr-config
AC_ARG_WITH(apr-config,
[[  --with-apr-config=FILE    Use the given path to apr-config when determining
                            APR configuration; defaults to "apr-config"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        APRCONFIG=$withval
    fi
])
AC_MSG_CHECKING([for APR])
if $APRCONFIG --cflags > /dev/null; then
    AC_MSG_RESULT([found])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([APR is required. Try --with-apr-config.])
fi
CPPFLAGS="$CPPFLAGS  `$APRCONFIG --cppflags` `$APRCONFIG --includes`"
CXXFLAGS="$CXXFLAGS `$APRCONFIG --cflags`"
APR_LIBS="`$APRCONFIG --link-ld --libs`"

dnl
dnl Subversion
dnl

SVN_INCLUDE="/usr/local/include"
AC_ARG_WITH(svn-include,
[[  --with-svn-include=DIR   Use the given path to the subversion headers;
                           defaults to "/usr/local/include"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        SVN_INCLUDE=$withval
    fi
])
AC_MSG_CHECKING([for Subversion headers])
if test -f "$SVN_INCLUDE/subversion-1/svn_types.h"; then
    AC_MSG_RESULT([found])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([Subversion headers are required. Try --with-svn-include.])
fi
CPPFLAGS="$CPPFLAGS -I$SVN_INCLUDE/subversion-1"

SVN_LIB="/usr/local/lib"
AC_ARG_WITH(svn-lib,
[[  --with-svn-lib=DIR  Use the given path to the subversion libraries;
                      defaults to "/usr/local/lib"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        SVN_LIB=$withval
    fi
])
AC_MSG_CHECKING([for Subversion libraries])
if test -f "$SVN_LIB/libsvn_client-1.so"; then
    AC_MSG_RESULT([found])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([Subversion libraries are required. Try --with-svn-lib.])
fi
   
dnl
dnl wxWindows
dnl

WXCONFIG=wx-config
AC_ARG_WITH(wx-config,
[[  --with-wx-config=FILE     Use the given path to wx-config when determining
                            wxWindows configuration; defaults to "wx-config"]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        WXCONFIG=$withval
    fi
])
AC_MSG_CHECKING([wxWindows version])
if wxversion=`$WXCONFIG --version`; then
    AC_MSG_RESULT([$wxversion])
else
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([wxWindows is required. Try --with-wx-config.])
fi
case $wxversion in
    [2.3.3])
        ;;
    [2.4.0])
        ;;
    *)
        AC_MSG_ERROR([wxWindows 2.3.3 or 2.4.0 required])
	AC_MSG_ERROR([Try --with-wx-config.])
        ;;
esac
CPPFLAGS="$CPPFLAGS `$WXCONFIG --cppflags`"
CXXFLAGS="$CXXFLAGS `$WXCONFIG --cxxflags | sed -e 's/-fno-exceptions//'`"
WX_LIBS="`$WXCONFIG --libs`"

dnl
dnl CppUnit
dnl 

CPPUNITCONFIG=
AC_ARG_WITH(cppunit-config,
[[  --with-cppunit-config=FILE     Use the given path to cppunit-config
                            when determining the cpp Unit configuration; 
                            defaults to ""]],
[
    if test "$withval" != "yes" -a "$withval" != ""; then
        CPPUNITCONFIG=$withval
    fi
])

AC_SUBST(APR_LIBS)
AC_SUBST(WX_LIBS)
AC_SUBST(SVN_LIB)

AC_OUTPUT(Makefile src/Makefile src/svncpp/Makefile src/res/Makefile)

if test "$CPPUNITCONFIG" ; then
    CPPUNIT_CXXFLAGS="`$CPPUNITCONFIG --cflags`"
    CPPUNIT_LIBS="`$CPPUNITCONFIG --libs`"
    AC_SUBST(CPPUNIT_LIBS)
    AC_SUBST(CPPUNIT_CXXFLAGS)
    AC_OUTPUT(src/tests/svncpp/Makefile)
fi
